<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parata Air Operation Tech Team Accounting System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; overflow-x: hidden; color: #1e293b; }
        .main-content { padding: 2.5rem; min-height: 100vh; max-width: 1400px; margin: 0 auto; }
        .card { background: white; border-radius: 1rem; border: 1px solid #e2e8f0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 1rem; }
        
        .view-content { display: none; }
        .view-active { display: block; animation: fadeIn 0.3s ease-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media print {
            .no-print { display: none !important; }
            .main-content { padding: 0; }
            .view-content { display: block !important; }
            #report-visual-mode, #report-table-mode { display: block !important; }
        }

        #editModal { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
        
        .nav-btn { position: relative; transition: all 0.3s; }
        .nav-btn.active { color: #2563eb; }
        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #2563eb;
            border-radius: 99px;
        }

        .page-link { transition: all 0.2s; cursor: pointer; }
        .page-link.active { background-color: #2563eb; color: white; border-color: #2563eb; }

        .toggle-btn { transition: all 0.2s; }
        .toggle-btn.active { background-color: #0f172a; color: white; }
    </style>
</head>
<body>

    <main class="main-content">
        <!-- Top Header -->
        <header class="mb-10 no-print">
            <div class="flex flex-col md:flex-row justify-between items-center border-b border-slate-200 pb-6 mb-6 gap-6">
                <div class="flex items-center gap-4">
                    <div class="bg-slate-900 p-2 rounded-lg text-white font-black text-xs tracking-tighter uppercase">Parata</div>
                    <div>
                        <h1 class="text-xl font-black text-slate-900 tracking-tight">ìš´í•­ ê¸°ìˆ íŒ€ íšŒê³„ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-wider">Operation Tech Team Accounting</p>
                    </div>
                </div>

                <nav class="flex items-center gap-8 bg-white px-6 py-3 rounded-2xl shadow-sm border border-slate-100">
                    <button onclick="window.switchView('view-dashboard')" id="nav-dashboard" class="nav-btn text-sm font-bold transition-all text-slate-500 hover:text-blue-600">ì¸ë³´ì´ìŠ¤ ê´€ë¦¬</button>
                    <button onclick="window.switchView('view-report')" id="nav-report" class="nav-btn text-sm font-bold transition-all text-slate-500 hover:text-blue-600">ë¶„ì„ ë¦¬í¬íŠ¸</button>
                    <button onclick="window.switchView('view-settings')" id="nav-settings" class="nav-btn text-sm font-bold transition-all text-slate-500 hover:text-blue-600">ì„¤ì • & ë°±ì—…</button>
                </nav>

                <div class="bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex gap-4">
                    <div class="flex flex-col items-center">
                        <span class="text-[9px] font-bold text-slate-400 uppercase mb-1">USD/KRW</span>
                        <input type="number" id="rateUsd" value="1350" oninput="window.handleRateChange()" class="text-xs font-bold w-16 text-center border-b border-slate-100 focus:border-blue-500 outline-none">
                    </div>
                    <div class="flex flex-col items-center border-l pl-4 border-slate-100">
                        <span class="text-[9px] font-bold text-slate-400 uppercase mb-1">EUR/KRW</span>
                        <input type="number" id="rateEur" value="1450" oninput="window.handleRateChange()" class="text-xs font-bold w-16 text-center border-b border-slate-100 focus:border-blue-500 outline-none">
                    </div>
                </div>
            </div>
        </header>

        <!-- View: Dashboard -->
        <div id="view-dashboard" class="view-content view-active space-y-8">
            
            <!-- Dashboard Filters -->
            <div class="flex items-center justify-between no-print">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 w-1.5 h-6 rounded-full"></div>
                    <h2 class="text-lg font-black text-slate-800">í†µê³„ ìš”ì•½ & í•„í„°</h2>
                </div>
                <div class="flex gap-2">
                    <div class="flex items-center gap-2 bg-white px-3 py-2 rounded-xl border border-slate-200 shadow-sm">
                        <span class="text-[10px] font-bold text-slate-400 uppercase">Year</span>
                        <select id="filterYear" onchange="window.handleListFilter()" class="text-xs font-black outline-none bg-transparent min-w-[80px]">
                            <option value="all">ëª¨ë“  ë…„ë„</option>
                        </select>
                    </div>
                    <div class="flex items-center gap-2 bg-white px-3 py-2 rounded-xl border border-slate-200 shadow-sm">
                        <span class="text-[10px] font-bold text-slate-400 uppercase">Vendor</span>
                        <select id="filterVendor" onchange="window.handleListFilter()" class="text-xs font-black outline-none bg-transparent min-w-[100px]">
                            <option value="all">ëª¨ë“  ì—…ì²´</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="card p-6 border-t-4 border-blue-600 transition-all hover:shadow-md">
                    <p class="text-[11px] font-bold text-slate-400 uppercase">í•„í„° í•©ê³„ (KRW)</p>
                    <h3 id="dashTotal" class="text-2xl font-black mt-1">0 ì›</h3>
                </div>
                <div class="card p-6 border-t-4 border-emerald-500 transition-all hover:shadow-md">
                    <p class="text-[11px] font-bold text-slate-400 uppercase">ì§€ê¸‰ ì™„ë£Œ (KRW)</p>
                    <h3 id="dashPaid" class="text-2xl font-black text-emerald-600 mt-1">0 ì›</h3>
                </div>
                <div class="card p-6 border-t-4 border-rose-500 transition-all hover:shadow-md">
                    <p class="text-[11px] font-bold text-slate-400 uppercase">ë¯¸ì§€ê¸‰ ì”ì•¡ (KRW)</p>
                    <h3 id="dashUnpaid" class="text-2xl font-black text-rose-600 mt-1">0 ì›</h3>
                </div>
                <div class="card p-6 border-t-4 border-amber-500 transition-all hover:shadow-md">
                    <p class="text-[11px] font-bold text-slate-400 uppercase">í•©ê³„ (USD í™˜ì‚°)</p>
                    <h3 id="dashTotalUsd" class="text-2xl font-black text-amber-600 mt-1">$ 0.00</h3>
                </div>
            </div>

            <section class="no-print">
                <div class="card p-8 shadow-lg">
                    <h2 class="text-lg font-bold mb-6 flex items-center gap-2">
                        <div class="w-1.5 h-5 bg-blue-600 rounded-full"></div>
                        ì¸ë³´ì´ìŠ¤ ë°ì´í„° ì…ë ¥ (Entry)
                    </h2>
                    <form id="accountingForm" class="space-y-6">
                        <div class="input-grid">
                            <div>
                                <label class="block text-[11px] font-bold text-slate-400 mb-2">ê³µê¸‰ì—…ì²´ (Vendor)</label>
                                <select id="vendorSelect" required onchange="window.toggleDirectInput('vendorSelect', 'vendorDirect')" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500 transition-all">
                                    <option value="">ì—…ì²´ ì„ íƒ</option>
                                    <option value="Honeywell">Honeywell</option>
                                    <option value="Navblue">Navblue</option>
                                    <option value="Jeppesen">Jeppesen</option>
                                    <option value="Airbus">Airbus</option>
                                    <option value="direct">ì§ì ‘ ì…ë ¥</option>
                                </select>
                                <input type="text" id="vendorDirect" placeholder="ì—…ì²´ëª… ì…ë ¥" class="hidden mt-2 w-full p-3 bg-white border border-blue-300 rounded-xl text-sm outline-none shadow-sm">
                            </div>

                            <div class="col-span-1 md:col-span-2 flex gap-3">
                                <div class="flex-1">
                                    <label class="block text-[11px] font-bold text-slate-400 mb-2">ê¸ˆì•¡ (Amount)</label>
                                    <input type="number" id="inputAmount" step="any" placeholder="0" required oninput="window.calculatePreview()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500 transition-all">
                                </div>
                                <div class="w-24">
                                    <label class="block text-[11px] font-bold text-slate-400 mb-2">í†µí™”</label>
                                    <select id="currency" onchange="window.calculatePreview()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500">
                                        <option value="KRW">KRW</option>
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                    </select>
                                </div>
                                <div class="flex-1">
                                    <label class="block text-[11px] font-bold text-blue-600 mb-2 uppercase">USD í™˜ì‚° (ë¯¸ë¦¬ë³´ê¸°)</label>
                                    <input type="text" id="previewUsd" placeholder="$ 0.00" readonly class="w-full p-3 bg-blue-50 border border-blue-100 rounded-xl text-sm text-blue-700 font-bold outline-none cursor-not-allowed">
                                </div>
                            </div>

                            <div>
                                <label class="block text-[11px] font-bold text-slate-400 mb-2">Invoice No.</label>
                                <input type="text" id="invoiceNo" placeholder="INV-000" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500 transition-all">
                            </div>

                            <div>
                                <label class="block text-[11px] font-bold text-slate-400 mb-2">ê¸°ì•ˆì (Drafter)</label>
                                <select id="drafterSelect" required onchange="window.toggleDirectInput('drafterSelect', 'drafterDirect')" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500 transition-all">
                                    <option value="">ê¸°ì•ˆì ì„ íƒ</option>
                                    <option value="ì´ìœ¨ë¹„">ì´ìœ¨ë¹„</option>
                                    <option value="ë°•ì •ì›">ë°•ì •ì›</option>
                                    <option value="ë„ì¬ìœ¤">ë„ì¬ìœ¤</option>
                                    <option value="ë°•ë‚¨ì¤€">ë°•ë‚¨ì¤€</option>
                                    <option value="ì´ì¢…í—Œ">ì´ì¢…í—Œ</option>
                                    <option value="direct">ì§ì ‘ ì…ë ¥</option>
                                </select>
                                <input type="text" id="drafterDirect" placeholder="ì„±í•¨ ì…ë ¥" class="hidden mt-2 w-full p-3 bg-white border border-blue-300 rounded-xl text-sm outline-none shadow-sm">
                            </div>

                            <div>
                                <label class="block text-[11px] font-bold text-slate-400 mb-2">ì¸ë³´ì´ìŠ¤ ì¼ì</label>
                                <input type="date" id="invoiceDate" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500 transition-all">
                            </div>

                            <div>
                                <label class="block text-[11px] font-bold text-slate-400 mb-2">ì§€ê¸‰ ìƒíƒœ</label>
                                <select id="isPaid" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500 transition-all">
                                    <option value="false">ë¯¸ì§€ê¸‰</option>
                                    <option value="true">ì§€ê¸‰ì™„ë£Œ</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex gap-4 items-end">
                            <div class="flex-1">
                                <label class="block text-[11px] font-bold text-slate-400 mb-2">ë¹„ê³  (Remarks)</label>
                                <input type="text" id="remarks" placeholder="íŠ¹ì´ì‚¬í•­ ì…ë ¥" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-blue-500 transition-all">
                            </div>
                            <button type="submit" class="bg-slate-900 text-white px-10 py-3 rounded-xl font-bold hover:bg-blue-600 transition-all shadow-lg active:scale-95 h-[46px]">ë°ì´í„° ì €ì¥</button>
                        </div>
                    </form>
                </div>
            </section>

            <div class="card overflow-hidden">
                <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center bg-white gap-4">
                    <h2 class="text-lg font-bold text-slate-800">ì§€ì¶œ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ (Audit List)</h2>
                    <div class="flex flex-wrap items-center gap-3 no-print">
                        <div class="flex items-center gap-2">
                            <input type="date" id="exportStart" class="p-2 border border-slate-200 rounded-lg text-xs outline-none">
                            <span class="text-slate-400">~</span>
                            <input type="date" id="exportEnd" class="p-2 border border-slate-200 rounded-lg text-xs outline-none">
                        </div>
                        <button onclick="window.exportToExcel()" class="text-xs bg-emerald-50 text-emerald-700 border border-emerald-200 px-4 py-2 rounded-lg font-bold hover:bg-emerald-100 transition flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                            ê¸°ê°„ ì„ íƒ ì—‘ì…€ ë‚´ë³´ë‚´ê¸°
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left border-collapse">
                        <thead>
                            <tr class="bg-slate-50 text-slate-400 border-b border-slate-200">
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest">ì¼ì</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest">Inv No.</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest">ì—…ì²´ëª…</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest text-center">ê¸°ì•ˆì</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest">ê¸ˆì•¡ (Original)</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest">KRW í™˜ì‚°</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest">USD í™˜ì‚°</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest text-center">ìƒíƒœ</th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest">ë¹„ê³ </th>
                                <th class="p-4 font-bold uppercase text-[10px] tracking-widest text-center no-print">ì•¡ì…˜</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody" class="divide-y divide-slate-100 bg-white"></tbody>
                    </table>
                    <div id="noDataMessage" class="p-20 text-center text-slate-400 italic font-medium hidden">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
                <div class="p-6 bg-slate-50 border-t border-slate-100 flex justify-center items-center gap-2 no-print" id="paginationControls"></div>
            </div>
        </div>

        <!-- View: Report -->
        <div id="view-report" class="view-content space-y-8">
            <div class="flex flex-col md:flex-row justify-between items-end no-print gap-4">
                <div>
                    <h2 class="text-3xl font-black text-slate-900">íšŒê³„ ë¶„ì„ ë¦¬í¬íŠ¸</h2>
                    <p class="text-slate-500 font-medium mt-1">ì§€ì¶œ ë‚´ì—­ ì‹œê°í™” ë° ë°ì´í„° ë¶„ì„</p>
                </div>
                <div class="flex items-center gap-2 bg-slate-200/50 p-1.5 rounded-2xl border border-slate-300 shadow-inner">
                    <button onclick="window.switchReportMode('visual')" id="report-btn-visual" class="toggle-btn active px-5 py-2.5 rounded-xl text-xs font-bold shadow-sm transition-all">ì°¨íŠ¸ ë¶„ì„</button>
                    <button onclick="window.switchReportMode('table')" id="report-btn-table" class="toggle-btn px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 hover:text-slate-800 transition-all">ë°ì´í„° ìƒì„¸</button>
                </div>
                <button onclick="window.print()" class="bg-slate-900 text-white px-6 py-2.5 rounded-xl font-bold hover:bg-blue-600 transition shadow-lg">PDF ì¶œë ¥ / ì €ì¥</button>
            </div>

            <!-- Report Filter -->
            <div class="card p-6 no-print bg-slate-50 border-blue-100 border-2 shadow-sm">
                <div class="flex flex-wrap items-end gap-6">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-widest">ë¶„ì„ ê¸°ê°„ ì„¤ì •</label>
                        <div class="flex items-center gap-2">
                            <input type="date" id="reportStart" onchange="window.handleReportFilterChange()" class="p-2.5 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                            <span class="text-slate-300">~</span>
                            <input type="date" id="reportEnd" onchange="window.handleReportFilterChange()" class="p-2.5 border border-slate-200 rounded-xl text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                        </div>
                    </div>
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-widest">ê³µê¸‰ì—…ì²´ í•„í„°</label>
                        <select id="reportVendorFilter" onchange="window.handleReportFilterChange()" class="p-2.5 border border-slate-200 rounded-xl text-sm outline-none min-w-[200px] font-semibold focus:ring-2 focus:ring-blue-500 transition-all">
                            <option value="all">ì „ì²´ ì—…ì²´ ë¶„ì„</option>
                        </select>
                    </div>
                    <div class="flex-1 text-right">
                        <button onclick="window.resetReportFilters()" class="text-xs text-slate-400 hover:text-blue-500 font-bold underline transition underline-offset-4">ì¡°ê±´ ì´ˆê¸°í™”</button>
                    </div>
                </div>
            </div>
            
            <div id="report-visual-mode" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="card p-8 flex flex-col items-center">
                    <h3 class="text-xs font-bold text-slate-400 mb-8 uppercase tracking-widest">ì—…ì²´ë³„ ì‹¤ ì§€ì¶œ ê¸ˆì•¡ (KRW)</h3>
                    <div class="h-[320px] w-full"><canvas id="vendorBarChart"></canvas></div>
                </div>
                <div class="card p-8 flex flex-col items-center">
                    <h3 class="text-xs font-bold text-slate-400 mb-8 uppercase tracking-widest">ì—°ë„ë³„ ì§€ì¶œ í•©ê³„ (KRW)</h3>
                    <div class="h-[320px] w-full"><canvas id="yearlyChart"></canvas></div>
                </div>
                <div class="card p-8 flex flex-col items-center">
                    <h3 class="text-xs font-bold text-slate-400 mb-8 uppercase tracking-widest">ì›”ë³„ ì§€ì¶œ ì¶”ì´</h3>
                    <div class="h-[320px] w-full"><canvas id="monthlyChart"></canvas></div>
                </div>
                <div class="card p-8 flex flex-col items-center">
                    <h3 class="text-xs font-bold text-slate-400 mb-8 uppercase tracking-widest">ì—…ì²´ë³„ ì§€ì¶œ ë¹„ì¤‘</h3>
                    <div class="h-[320px] w-full"><canvas id="vendorChart"></canvas></div>
                </div>
                <div class="card p-8 flex flex-col items-center">
                    <h3 class="text-xs font-bold text-slate-400 mb-8 uppercase tracking-widest">ì§€ê¸‰ ìƒíƒœ í˜„í™©</h3>
                    <div class="h-[320px] w-full"><canvas id="statusChart"></canvas></div>
                </div>
                <div class="bg-slate-900 text-white p-10 rounded-3xl shadow-2xl flex flex-col justify-center border-t-4 border-blue-500">
                    <h3 class="text-2xl font-black mb-6 text-blue-400">ğŸ“Š í•„í„° ë¶„ì„ ìš”ì•½</h3>
                    <ul id="insights-list" class="space-y-5 text-slate-300 font-medium"></ul>
                </div>
            </div>

            <div id="report-table-mode" class="hidden">
                <div class="card overflow-hidden shadow-lg border-blue-100">
                    <div class="p-5 border-b bg-slate-900 text-white flex justify-between items-center">
                        <span class="text-sm font-bold">ë°ì´í„° ìƒì„¸ ë¸Œë¼ìš°ì§• (Excel Style)</span>
                        <span id="report-table-count" class="text-xs bg-blue-600 px-2 py-1 rounded text-white font-bold">0 Items</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-xs text-left border-collapse font-medium">
                            <thead>
                                <tr class="bg-slate-100 text-slate-500 border-b">
                                    <th class="p-4 font-black">ì¼ì</th>
                                    <th class="p-4 font-black">Invoice No.</th>
                                    <th class="p-4 font-black">ì—…ì²´ëª…</th>
                                    <th class="p-4 font-black">ê¸°ì•ˆì</th>
                                    <th class="p-4 font-black">ì›ë³¸ê¸ˆì•¡</th>
                                    <th class="p-4 font-black text-blue-600">KRW í™˜ì‚°</th>
                                    <th class="p-4 font-black text-amber-600">USD í™˜ì‚°</th>
                                    <th class="p-4 font-black text-center">ì§€ê¸‰ìƒíƒœ</th>
                                    <th class="p-4 font-black">ë¹„ê³ </th>
                                </tr>
                            </thead>
                            <tbody id="reportDataOnlyBody" class="divide-y divide-slate-100 bg-white"></tbody>
                        </table>
                    </div>
                    <div class="p-6 bg-slate-50 border-t border-slate-100 flex justify-center items-center gap-2 no-print" id="reportPaginationControls"></div>
                </div>
            </div>
        </div>

        <!-- View: Settings -->
        <div id="view-settings" class="view-content space-y-8">
            <h2 class="text-3xl font-black text-slate-900 tracking-tight">ì‹œìŠ¤í…œ ì„¤ì • ë° í´ë¼ìš°ë“œ ê´€ë¦¬</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="card p-8">
                    <h3 class="text-lg font-bold mb-4">ë°ì´í„° ë¡œì»¬ ë°±ì—…</h3>
                    <div class="space-y-3">
                        <button onclick="window.downloadBackup()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold hover:bg-blue-700 transition shadow-md">ë°±ì—… íŒŒì¼(.json) ìƒì„±</button>
                    </div>
                </div>
                <div class="card p-8 bg-slate-50 border-none font-mono text-[11px] leading-relaxed">
                    <h3 class="text-lg font-bold mb-4 text-slate-700">Storage Information</h3>
                    <p class="text-slate-500">Database Engine: <span class="text-blue-600 font-bold">Firebase Realtime DB</span></p>
                    <p class="text-slate-500">Last Sync: <span id="sync-time" class="font-bold">Now</span></p>
                </div>
            </div>
        </div>

        <!-- Edit Modal -->
        <div id="editModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
            <div class="card w-full max-w-2xl p-8 shadow-2xl animate-fadeIn">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-black">í•­ëª© ìˆ˜ì • (Modify)</h2>
                    <button onclick="window.closeEditModal()" class="text-slate-400 hover:text-slate-900"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
                </div>
                <form id="editForm" class="space-y-4">
                    <input type="hidden" id="editId">
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">ì¼ì</label><input type="date" id="editDate" required class="w-full p-3 bg-slate-50 border rounded-xl text-sm outline-none"></div>
                        <div><label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">Invoice No.</label><input type="text" id="editInvNo" required class="w-full p-3 bg-slate-50 border rounded-xl text-sm outline-none"></div>
                        <div><label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">ê¸ˆì•¡</label><input type="number" id="editAmount" step="any" required class="w-full p-3 bg-slate-50 border rounded-xl text-sm outline-none"></div>
                        <div><label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">í†µí™”</label><select id="editCurrency" class="w-full p-3 bg-slate-50 border rounded-xl text-sm outline-none"><option value="KRW">KRW</option><option value="USD">USD</option><option value="EUR">EUR</option></select></div>
                    </div>
                    <div><label class="block text-[10px] font-bold text-slate-400 uppercase mb-1">ë¹„ê³ </label><input type="text" id="editRemarks" class="w-full p-3 bg-slate-50 border rounded-xl text-sm outline-none"></div>
                    <button type="submit" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black hover:bg-blue-600 transition shadow-lg mt-4">ì €ì¥</button>
                </form>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBb8ruxrJa-Fw4s5bwy_10TeH6_TgOhnz4",
            authDomain: "parataoe-769bb.firebaseapp.com",
            projectId: "parataoe-769bb",
            databaseURL: "https://parataoe-769bb-default-rtdb.firebaseio.com/",
            storageBucket: "parataoe-769bb.firebasestorage.app",
            messagingSenderId: "964545748384",
            appId: "1:964545748384:web:f882221099022e4271d8c5",
            measurementId: "G-5LJ4QR4XED"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const invoicesRef = ref(db, 'invoices');

        let invoices = [];
        let charts = { vendor: null, monthly: null, status: null, yearly: null, vendorBar: null };
        
        // Dashboard Pagination
        let currentPage = 1;
        const itemsPerPage = 10;

        // Report Pagination
        let currentReportPage = 1;
        const reportItemsPerPage = 15;
        let currentReportMode = 'visual';

        onValue(invoicesRef, (snapshot) => {
            const data = snapshot.val();
            invoices = data ? Object.entries(data).map(([id, val]) => ({ id, ...val })) : [];
            updateFilterOptions();
            renderTable(); 
            if (document.getElementById('view-report').classList.contains('view-active')) {
                updateVendorFilterList();
                updateCharts();
            }
            document.getElementById('sync-time').innerText = new Date().toLocaleTimeString();
        });

        window.switchView = (viewId) => {
            document.querySelectorAll('.view-content').forEach(v => v.classList.remove('view-active'));
            document.getElementById(viewId).classList.add('view-active');
            document.querySelectorAll('.nav-btn').forEach(btn => { btn.classList.remove('text-blue-600', 'active'); btn.classList.add('text-slate-500'); });
            const navId = 'nav-' + viewId.split('-')[1];
            const activeBtn = document.getElementById(navId);
            activeBtn.classList.remove('text-slate-500');
            activeBtn.classList.add('text-blue-600', 'active');
            if (viewId === 'view-report') { 
                updateVendorFilterList(); 
                currentReportPage = 1;
                updateCharts(); 
            }
        };

        window.switchReportMode = (mode) => {
            currentReportMode = mode;
            const visualSection = document.getElementById('report-visual-mode');
            const tableSection = document.getElementById('report-table-mode');
            const btnVisual = document.getElementById('report-btn-visual');
            const btnTable = document.getElementById('report-btn-table');
            if (mode === 'visual') { visualSection.classList.remove('hidden'); tableSection.classList.add('hidden'); btnVisual.classList.add('active'); btnTable.classList.remove('active'); btnTable.classList.add('text-slate-500'); }
            else { 
                visualSection.classList.add('hidden'); tableSection.classList.remove('hidden'); btnVisual.classList.remove('active'); btnVisual.classList.add('text-slate-500'); btnTable.classList.add('active'); 
                currentReportPage = 1;
            }
            updateCharts();
        };

        window.toggleDirectInput = (selectId, inputId) => {
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            if (select.value === 'direct') { input.classList.remove('hidden'); input.required = true; }
            else { input.classList.add('hidden'); input.required = false; }
        };

        window.calculatePreview = () => {
            const amount = parseFloat(document.getElementById('inputAmount').value) || 0;
            const currency = document.getElementById('currency').value;
            const rateUsd = parseFloat(document.getElementById('rateUsd').value) || 1350;
            const rateEur = parseFloat(document.getElementById('rateEur').value) || 1450;
            const preview = document.getElementById('previewUsd');
            let res = 0;
            if (currency === 'KRW') res = amount / rateUsd;
            else if (currency === 'USD') res = amount;
            else if (currency === 'EUR') res = (amount * rateEur) / rateUsd;
            preview.value = amount > 0 ? `$ ${res.toLocaleString(undefined, {minimumFractionDigits: 2})}` : '';
        };

        window.handleRateChange = () => { window.calculatePreview(); renderTable(); };

        document.getElementById('accountingForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('inputAmount').value) || 0;
            const curr = document.getElementById('currency').value;
            const rUsd = parseFloat(document.getElementById('rateUsd').value) || 1350;
            const rEur = parseFloat(document.getElementById('rateEur').value) || 1450;
            let krw = 0, usd = 0;
            if (curr === 'KRW') { krw = amount; usd = amount / rUsd; } else if (curr === 'USD') { krw = amount * rUsd; usd = amount; } else if (curr === 'EUR') { krw = amount * rEur; usd = krw / rUsd; }
            const vendor = document.getElementById('vendorSelect').value === 'direct' ? document.getElementById('vendorDirect').value : document.getElementById('vendorSelect').value;
            const drafter = document.getElementById('drafterSelect').value === 'direct' ? document.getElementById('drafterDirect').value : document.getElementById('drafterSelect').value;
            const entry = { invoiceDate: document.getElementById('invoiceDate').value, invoiceNo: document.getElementById('invoiceNo').value, vendor: vendor || 'Unknown', originalAmount: amount, originalCurrency: curr, amountKrw: Math.round(krw), amountUsd: usd, drafter: drafter || 'Unknown', isPaid: document.getElementById('isPaid').value === 'true', remarks: document.getElementById('remarks').value };
            push(invoicesRef, entry); e.target.reset(); document.getElementById('vendorDirect').classList.add('hidden'); document.getElementById('drafterDirect').classList.add('hidden'); document.getElementById('previewUsd').value = '';
        });

        function updateStats(filteredData) {
            const tK = filteredData.reduce((s, i) => s + i.amountKrw, 0);
            const pK = filteredData.filter(i => i.isPaid).reduce((s, i) => s + i.amountKrw, 0);
            const tU = filteredData.reduce((s, i) => s + i.amountUsd, 0);
            document.getElementById('dashTotal').innerText = tK.toLocaleString() + " ì›";
            document.getElementById('dashPaid').innerText = pK.toLocaleString() + " ì›";
            document.getElementById('dashUnpaid').innerText = (tK - pK).toLocaleString() + " ì›";
            document.getElementById('dashTotalUsd').innerText = `$ ${tU.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
        }

        function updateFilterOptions() {
            const years = [...new Set(invoices.map(i => i.invoiceDate.split('-')[0]))].sort().reverse();
            const vendors = [...new Set(invoices.map(i => i.vendor))].sort();
            const yearSelect = document.getElementById('filterYear'); const vendorSelect = document.getElementById('filterVendor');
            const currentYear = yearSelect.value; const currentVendor = vendorSelect.value;
            yearSelect.innerHTML = '<option value="all">ëª¨ë“  ë…„ë„</option>' + years.map(y => `<option value="${y}">${y}ë…„</option>`).join('');
            vendorSelect.innerHTML = '<option value="all">ëª¨ë“  ì—…ì²´</option>' + vendors.map(v => `<option value="${v}">${v}</option>`).join('');
            yearSelect.value = currentYear; vendorSelect.value = currentVendor;
        }

        window.handleListFilter = () => { currentPage = 1; renderTable(); };
        window.changePage = (p) => { currentPage = p; renderTable(); };

        function renderPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const container = document.getElementById('paginationControls');
            if (totalPages <= 1) { container.innerHTML = ''; return; }
            let html = `<button onclick="window.changePage(${Math.max(1, currentPage - 1)})" class="p-2 text-slate-400 hover:text-slate-900 transition-colors ${currentPage === 1 ? 'invisible' : ''}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button>`;
            for (let i = 1; i <= totalPages; i++) { html += `<button onclick="window.changePage(${i})" class="page-link w-8 h-8 rounded-lg text-xs font-bold border border-slate-200 flex items-center justify-center ${currentPage === i ? 'active' : 'bg-white text-slate-600 hover:bg-slate-50'}">${i}</button>`; }
            html += `<button onclick="window.changePage(${Math.min(totalPages, currentPage + 1)})" class="p-2 text-slate-400 hover:text-slate-900 transition-colors ${currentPage === totalPages ? 'invisible' : ''}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button>`;
            container.innerHTML = html;
        }

        function renderTable() {
            const list = document.getElementById('reportTableBody'); const noData = document.getElementById('noDataMessage');
            const yearVal = document.getElementById('filterYear').value; const vendorVal = document.getElementById('filterVendor').value;
            let filtered = [...invoices];
            if (yearVal !== 'all') filtered = filtered.filter(i => i.invoiceDate.startsWith(yearVal));
            if (vendorVal !== 'all') filtered = filtered.filter(i => i.vendor === vendorVal);
            updateStats(filtered);
            if (filtered.length === 0) { list.innerHTML = ''; noData.classList.remove('hidden'); document.getElementById('paginationControls').innerHTML = ''; return; }
            noData.classList.add('hidden');
            const sorted = filtered.sort((a, b) => new Date(b.invoiceDate) - new Date(a.invoiceDate));
            const startIdx = (currentPage - 1) * itemsPerPage; const pagedItems = sorted.slice(startIdx, startIdx + itemsPerPage);
            list.innerHTML = pagedItems.map(inv => `
                <tr class="hover:bg-slate-50 border-b border-slate-100 transition-colors">
                    <td class="p-4 font-bold text-slate-700">${inv.invoiceDate}</td><td class="p-4 font-mono text-[11px] text-slate-400">${inv.invoiceNo}</td><td class="p-4 font-black text-slate-900">${inv.vendor}</td><td class="p-4 text-center font-bold text-slate-600 text-xs">${inv.drafter}</td><td class="p-4 font-medium text-slate-500">${inv.originalAmount.toLocaleString()} ${inv.originalCurrency}</td><td class="p-4 font-bold text-blue-700">${inv.amountKrw.toLocaleString()}</td><td class="p-4 font-bold text-amber-600">$ ${inv.amountUsd.toLocaleString(undefined, {minimumFractionDigits: 2})}</td><td class="p-4 text-center"><button onclick="window.togglePaid('${inv.id}', ${inv.isPaid})" class="px-3 py-1.5 rounded-lg text-[10px] font-black uppercase transition-all ${inv.isPaid ? 'bg-emerald-500 text-white shadow-md' : 'bg-rose-100 text-rose-600'}">${inv.isPaid ? 'ì§€ê¸‰ì™„ë£Œ' : 'ë¯¸ì§€ê¸‰'}</button></td><td class="p-4 text-xs text-slate-500 max-w-[150px] break-words">${inv.remarks || '-'}</td>
                    <td class="p-4 text-center no-print whitespace-nowrap"><button onclick="window.openEditModal('${inv.id}')" class="text-slate-300 hover:text-blue-500 p-2 mr-1"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg></button><button onclick="window.deleteItem('${inv.id}')" class="text-slate-300 hover:text-rose-500 p-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></td>
                </tr>`).join('');
            renderPagination(filtered.length);
        }

        window.deleteItem = (id) => { if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) remove(ref(db, `invoices/${id}`)); };
        window.togglePaid = (id, currentStatus) => { update(ref(db, `invoices/${id}`), { isPaid: !currentStatus }); };
        window.openEditModal = (id) => {
            const item = invoices.find(i => i.id === id); if (!item) return;
            document.getElementById('editId').value = id; document.getElementById('editDate').value = item.invoiceDate; document.getElementById('editInvNo').value = item.invoiceNo; document.getElementById('editAmount').value = item.originalAmount; document.getElementById('editCurrency').value = item.originalCurrency; document.getElementById('editRemarks').value = item.remarks || ''; document.getElementById('editModal').classList.remove('hidden');
        };
        window.closeEditModal = () => document.getElementById('editModal').classList.add('hidden');
        document.getElementById('editForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const id = document.getElementById('editId').value; const amount = parseFloat(document.getElementById('editAmount').value); const curr = document.getElementById('editCurrency').value; const rUsd = parseFloat(document.getElementById('rateUsd').value); const rEur = parseFloat(document.getElementById('rateEur').value);
            let krw = 0, usd = 0; if (curr === 'KRW') { krw = amount; usd = amount / rUsd; } else if (curr === 'USD') { krw = amount * rUsd; usd = amount; } else if (curr === 'EUR') { krw = amount * rEur; usd = krw / rUsd; }
            const updates = { invoiceDate: document.getElementById('editDate').value, invoiceNo: document.getElementById('editInvNo').value, originalAmount: amount, originalCurrency: curr, amountKrw: Math.round(krw), amountUsd: usd, remarks: document.getElementById('editRemarks').value };
            update(ref(db, `invoices/${id}`), updates).then(() => window.closeEditModal());
        });

        function updateVendorFilterList() { const filterSelect = document.getElementById('reportVendorFilter'); const currentVal = filterSelect.value; const uniqueVendors = [...new Set(invoices.map(i => i.vendor))].sort(); let options = '<option value="all">ì „ì²´ ì—…ì²´ ë¶„ì„</option>'; uniqueVendors.forEach(v => { options += `<option value="${v}" ${currentVal === v ? 'selected' : ''}>${v}</option>`; }); filterSelect.innerHTML = options; }
        window.resetReportFilters = () => { document.getElementById('reportStart').value = ''; document.getElementById('reportEnd').value = ''; document.getElementById('reportVendorFilter').value = 'all'; currentReportPage = 1; window.updateCharts(); };

        window.handleReportFilterChange = () => {
            currentReportPage = 1;
            updateCharts();
        };

        window.changeReportPage = (p) => {
            currentReportPage = p;
            updateCharts();
        };

        window.updateCharts = () => {
            const start = document.getElementById('reportStart').value; const end = document.getElementById('reportEnd').value; const vendorFilter = document.getElementById('reportVendorFilter').value;
            let filtered = [...invoices]; if (start) filtered = filtered.filter(i => i.invoiceDate >= start); if (end) filtered = filtered.filter(i => i.invoiceDate <= end); if (vendorFilter !== 'all') filtered = filtered.filter(i => i.vendor === vendorFilter);
            
            document.getElementById('report-table-count').innerText = `${filtered.length} Items`;
            
            if (currentReportMode === 'table') {
                renderReportTable(filtered);
            }
            
            if (filtered.length === 0) { clearCharts(); document.getElementById('insights-list').innerHTML = '<li class="text-rose-400">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>'; return; }
            const vSum = {}; const mSum = {}; const ySum = {};
            filtered.forEach(i => { vSum[i.vendor] = (vSum[i.vendor] || 0) + i.amountKrw; const m = i.invoiceDate.substring(0, 7); if(m) mSum[m] = (mSum[m] || 0) + i.amountKrw; const y = i.invoiceDate.substring(0, 4); if(y) ySum[y] = (ySum[y] || 0) + i.amountKrw; });
            const pCount = filtered.filter(i => i.isPaid).length;
            
            if (charts.vendor) charts.vendor.destroy(); charts.vendor = new Chart(document.getElementById('vendorChart'), { type:'doughnut', data:{ labels:Object.keys(vSum), datasets:[{data:Object.values(vSum), backgroundColor:['#3b82f6','#10b981','#f59e0b','#ef4444','#8b5cf6'], borderWidth:0}]}, options:{responsive:true, maintainAspectRatio:false}});
            if (charts.vendorBar) charts.vendorBar.destroy(); charts.vendorBar = new Chart(document.getElementById('vendorBarChart'), { type:'bar', data:{ labels:Object.keys(vSum), datasets:[{label:'ì§€ì¶œì•¡(KRW)', data:Object.values(vSum), backgroundColor:'#3b82f6', borderRadius:5}]}, options:{indexAxis:'y', responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}}});
            if (charts.yearly) charts.yearly.destroy(); const yKeys = Object.keys(ySum).sort(); charts.yearly = new Chart(document.getElementById('yearlyChart'), { type:'bar', data:{ labels:yKeys.map(y=>y+'ë…„'), datasets:[{label:'ì—°ê°„ í•©ê³„', data:yKeys.map(k=>ySum[k]), backgroundColor:'#8b5cf6', borderRadius:8}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}}});
            if (charts.monthly) charts.monthly.destroy(); const sM = Object.keys(mSum).sort(); charts.monthly = new Chart(document.getElementById('monthlyChart'), { type:'bar', data:{ labels:sM, datasets:[{label:'ì§€ì¶œì•¡(KRW)', data:sM.map(m=>mSum[m]), backgroundColor:'#10b981', borderRadius:8}]}, options:{responsive:true, maintainAspectRatio:false}});
            if (charts.status) charts.status.destroy(); charts.status = new Chart(document.getElementById('statusChart'), { type:'pie', data:{ labels:['ì§€ê¸‰ì™„ë£Œ','ë¯¸ì§€ê¸‰'], datasets:[{data:[pCount, filtered.length - pCount], backgroundColor:['#10b981','#f43f5e']}]}, options:{responsive:true, maintainAspectRatio:false}});
            const topV = Object.entries(vSum).sort((a,b)=>b[1]-a[1])[0];
            document.getElementById('insights-list').innerHTML = `<li class="flex gap-2 items-center"><span>âœ…</span> ì§€ì¶œ 1ìœ„: <b class="text-blue-400">${topV ? topV[0] : '-'}</b></li><li class="flex gap-2 items-center"><span>âœ…</span> ì´ ì§€ì¶œì•¡: <b class="text-emerald-400">${filtered.reduce((a,b)=>a+b.amountKrw,0).toLocaleString()}ì›</b></li>`;
        };

        function renderReportTable(data) {
            const body = document.getElementById('reportDataOnlyBody');
            const pagination = document.getElementById('reportPaginationControls');
            
            if (data.length === 0) { 
                body.innerHTML = '<tr><td colspan="9" class="p-10 text-center">ë°ì´í„° ì—†ìŒ</td></tr>'; 
                pagination.innerHTML = '';
                return; 
            }
            
            const sorted = data.sort((a, b) => new Date(b.invoiceDate) - new Date(a.invoiceDate));
            const totalPages = Math.ceil(sorted.length / reportItemsPerPage);
            
            // Slice for pagination
            const startIdx = (currentReportPage - 1) * reportItemsPerPage;
            const pagedItems = sorted.slice(startIdx, startIdx + reportItemsPerPage);
            
            body.innerHTML = pagedItems.map(inv => `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="p-4">${inv.invoiceDate}</td>
                    <td class="p-4 font-mono text-slate-400">${inv.invoiceNo}</td>
                    <td class="p-4 font-bold text-slate-800">${inv.vendor}</td>
                    <td class="p-4">${inv.drafter}</td>
                    <td class="p-4 text-slate-500">${inv.originalAmount.toLocaleString()} ${inv.originalCurrency}</td>
                    <td class="p-4 font-bold text-blue-600">${inv.amountKrw.toLocaleString()}</td>
                    <td class="p-4 font-bold text-amber-600">$ ${inv.amountUsd.toLocaleString(undefined, {minimumFractionDigits: 2})}</td>
                    <td class="p-4 text-center">
                        <span class="px-2 py-1 rounded text-[10px] font-black ${inv.isPaid ? 'bg-emerald-100 text-emerald-700' : 'bg-rose-100 text-rose-700'}">${inv.isPaid ? 'PAID' : 'PENDING'}</span>
                    </td>
                    <td class="p-4 text-xs italic">${inv.remarks || '-'}</td>
                </tr>`).join('');
                
            // Render Pagination for Report
            if (totalPages <= 1) { 
                pagination.innerHTML = ''; 
            } else {
                let html = `<button onclick="window.changeReportPage(${Math.max(1, currentReportPage - 1)})" class="p-2 text-slate-400 hover:text-slate-900 transition-colors ${currentReportPage === 1 ? 'invisible' : ''}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button>`;
                for (let i = 1; i <= totalPages; i++) {
                    html += `<button onclick="window.changeReportPage(${i})" class="page-link w-8 h-8 rounded-lg text-xs font-bold border border-slate-200 flex items-center justify-center ${currentReportPage === i ? 'active' : 'bg-white text-slate-600 hover:bg-slate-50'}">${i}</button>`;
                }
                html += `<button onclick="window.changeReportPage(${Math.min(totalPages, currentReportPage + 1)})" class="p-2 text-slate-400 hover:text-slate-900 transition-colors ${currentReportPage === totalPages ? 'invisible' : ''}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button>`;
                pagination.innerHTML = html;
            }
        }

        function clearCharts() { Object.values(charts).forEach(c => { if(c) c.destroy(); }); }
        window.exportToExcel = () => { const start = document.getElementById('exportStart').value; const end = document.getElementById('exportEnd').value; let exportData = invoices; if (start) exportData = exportData.filter(i => i.invoiceDate >= start); if (end) exportData = exportData.filter(i => i.invoiceDate <= end); if (exportData.length === 0) return alert("ë°ì´í„° ì—†ìŒ"); const data = exportData.map(i => ({ì¼ì:i.invoiceDate, No:i.invoiceNo, ì—…ì²´:i.vendor, ê¸°ì•ˆì:i.drafter, ì›ë³¸ê¸ˆì•¡:i.originalAmount, í†µí™”:i.originalCurrency, KRWí™˜ì‚°:i.amountKrw, USDí™˜ì‚°:i.amountUsd, ìƒíƒœ:i.isPaid?'ì™„ë£Œ':'ë¯¸ì§€ê¸‰', ë¹„ê³ :i.remarks})); const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Report"); XLSX.writeFile(wb, `Report_${new Date().toISOString().slice(0,10)}.xlsx`); };
        window.downloadBackup = () => { const data = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(invoices)); const a = document.createElement('a'); a.href = data; a.download = `Backup.json`; a.click(); };
        window.switchView('view-dashboard');
    </script>
</body>
</html>
